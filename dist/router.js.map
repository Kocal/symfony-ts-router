{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./src/router.ts"],"names":["root","factory","exports","module","define","amd","a","i","window","installedModules","__webpack_require__","moduleId","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","TokenType","context","routes","base_url","prefix","host","scheme","this","setRoutes","setRoutingData","data","setBaseUrl","setPrefix","setHost","setScheme","freeze","getRoutes","baseUrl","getBaseUrl","getScheme","getHost","getRoute","prefixedName","Error","generate","params","absolute","route","unusedParams","url","isOptional","tokens","forEach","rawToken","token","parseToken","Text","type","pattern","Variable","hasDefault","defaults","encodedValue","encodeURIComponent","replace","Array","isArray","hosttokens","requirements","schemes","keys","length","add","push","buildQueryParams","join","rbracket","RegExp","val","test","Router"],"mappings":"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","file":"router.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export class Router\n{\n    private context: Context = {base_url: '', prefix: '', host: '', scheme: ''};\n    private routes: RoutesMap;\n\n    constructor(context: Partial<Context> = {}, routes: RoutesMap = {})\n    {\n        this.context = {...this.context, ...context};\n        this.setRoutes(routes);\n    }\n\n    setRoutingData(data: RoutingData): void\n    {\n        this.setBaseUrl(data.base_url);\n        this.setRoutes(data.routes);\n\n        if ('prefix' in data) {\n            this.setPrefix(data.prefix);\n        }\n\n        this.setHost(data.host);\n        this.setScheme(data.scheme);\n    }\n\n    setRoutes(routes: RoutesMap): void\n    {\n        this.routes = Object.freeze(routes);\n    }\n\n    getRoutes(): RoutesMap\n    {\n        return this.routes;\n    }\n\n    setBaseUrl(baseUrl: string): void\n    {\n        this.context.base_url = baseUrl;\n    }\n\n    getBaseUrl(): string\n    {\n        return this.context.base_url;\n    }\n\n    setPrefix(prefix: string): void\n    {\n        this.context.prefix = prefix;\n    }\n\n    setScheme(scheme: string): void\n    {\n        this.context.scheme = scheme;\n    }\n\n    getScheme(): string\n    {\n        return this.context.scheme;\n    }\n\n    setHost(host: string): void\n    {\n        this.context.host = host;\n    }\n\n    getHost(): string\n    {\n        return this.context.host;\n    }\n\n    getRoute(name: string): Route\n    {\n        const prefixedName = this.context.prefix + name;\n\n        if (prefixedName in this.routes) {\n            return this.routes[prefixedName]\n\n        } else if (name in this.routes) {\n            return this.routes[name]\n        }\n\n        throw new Error(`The route \"${name}\" does not exist.`);\n    }\n\n    generate(name: string, params: RouteParams = {}, absolute = false): string\n    {\n        const route = this.getRoute(name);\n\n        let unusedParams = {...params};\n        let url = '';\n        let isOptional = true;\n        let host = '';\n\n        route.tokens.forEach(rawToken => {\n\n            const token = this.parseToken(rawToken);\n\n            if (TokenType.Text === token.type) {\n                url = token.pattern + url;\n                isOptional = false;\n\n                return;\n            }\n\n            if (TokenType.Variable === token.type) {\n                let hasDefault = route.defaults && (token.name in route.defaults);\n                if (false === isOptional\n                    || !hasDefault\n                    || ((token.name in params) && params[token.name] != route.defaults[token.name])\n                ) {\n                    let value;\n\n                    if (token.name in params) {\n                        value = params[token.name];\n                        delete unusedParams[token.name];\n\n                    } else if (hasDefault) {\n                        value = route.defaults[token.name];\n\n                    } else if (isOptional) {\n                        return;\n\n                    } else {\n                        throw new Error(`The route \"${name}\" requires the parameter \"${token.name}\".`);\n                    }\n\n                    const isEmpty = true === value || false === value || '' === value;\n\n                    if (!isEmpty || !isOptional) {\n                        let encodedValue = encodeURIComponent(value).replace(/%2F/g, '/');\n\n                        if ('null' === encodedValue && null === value) {\n                            encodedValue = '';\n                        }\n\n                        url = token.prefix + encodedValue + url;\n                    }\n\n                    isOptional = false;\n\n                } else if (hasDefault && (token.name in unusedParams)) {\n                    delete unusedParams[token.name];\n                }\n\n                return;\n            }\n        });\n\n        if (url === '') {\n            url = '/';\n        }\n\n        if (Array.isArray(route.hosttokens)) {\n            route.hosttokens.forEach(rawToken => {\n                let value: string|number;\n\n                const token = this.parseToken(rawToken);\n\n                if (TokenType.Text === token.type) {\n                    host = token.pattern + host;\n                    return;\n                }\n\n                if (TokenType.Variable === token.type) {\n                    if (token.name in params) {\n                        value = params[token.name];\n                        delete unusedParams[token.name];\n\n                    } else if (route.defaults && (token.name in route.defaults)) {\n                        value = route.defaults[token.name];\n                    }\n\n                    host = token.prefix + value + host;\n                }\n            });\n        }\n\n        url = this.getBaseUrl() + url;\n        if (route.requirements && (\"_scheme\" in route.requirements) && this.getScheme() != route.requirements[\"_scheme\"]) {\n            url = route.requirements[\"_scheme\"] + \"://\" + (host || this.getHost()) + url;\n\n        } else if (\"undefined\" !== typeof route.schemes\n            && \"undefined\" !== typeof route.schemes[0]\n            && this.getScheme() !== route.schemes[0]\n        ) {\n            url = route.schemes[0] + \"://\" + (host || this.getHost()) + url;\n\n        } else if (host && this.getHost() !== host) {\n            url = this.getScheme() + \"://\" + host + url;\n\n        } else if (absolute === true) {\n            url = this.getScheme() + \"://\" + this.getHost() + url;\n        }\n\n        if (Object.keys(unusedParams).length > 0) {\n            let queryParams = [];\n            const add = (key, value) => {\n                value = (typeof value === 'function') ? value() : value;\n                value = (value === null) ? '' : value;\n\n                queryParams.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\n            };\n\n            for (let prefix in unusedParams) {\n                this.buildQueryParams(prefix, unusedParams[prefix], add);\n            }\n\n            url = url + '?' + queryParams.join('&').replace(/%20/g, '+');\n        }\n\n        return url;\n    }\n\n    private buildQueryParams(prefix: string, params: any[]|object|string, add: QueryParamAddFunction): void\n    {\n        const rbracket = new RegExp(/\\[\\]$/);\n\n        if (params instanceof Array) {\n            params.forEach((val, i) => {\n                if (rbracket.test(prefix)) {\n                    add(prefix, val);\n                } else {\n                    this.buildQueryParams(`${prefix}[${typeof val === 'object' ? i : ''}]`, val, add);\n                }\n            });\n\n        } else if (typeof params === 'object') {\n            for (let name in params) {\n                this.buildQueryParams(`${prefix}[${name}]`, params[name], add);\n            }\n\n        } else {\n            add(prefix, params);\n        }\n    }\n\n    private parseToken(token: Token): ParsedToken\n    {\n        let type, prefix, pattern, name;\n\n        switch (token[0]) {\n            case TokenType.Text:\n                [type, pattern] = token;\n                break;\n\n            case TokenType.Variable:\n                [type, prefix, pattern, name] = token;\n                break;\n\n            default:\n                throw new Error(`The token type \"${type}\" is not supported.`);\n        }\n\n        return {type, prefix, pattern, name}\n    }\n}\n\nexport type RouteDefaults = {[index:string]: string|number}\n\nexport type RouteRequirements = {[index:string]: string|number}\n\nexport type RouteParams = {[index:string]: any}\n\nexport type RoutesMap = {[index: string]: Route}\n\nexport interface QueryParamAddFunction\n{\n    (prefix: string, params: any): void;\n}\n\nexport interface Route\n{\n    tokens: Token[]\n    defaults?: RouteDefaults\n    requirements?: RouteRequirements\n    hosttokens?: Token[]\n    schemes?: string[]\n    methods?: string[]\n}\n\nexport interface RoutingData extends Context\n{\n    routes: RoutesMap\n}\n\nexport interface Context\n{\n    base_url: string;\n    prefix?: string\n    host?: string\n    scheme?: string\n}\n\nexport enum TokenType\n{\n    Text = 'text',\n    Variable = 'variable',\n}\n\nexport type Token = (string|boolean)[]\n\nexport interface ParsedToken\n{\n    type: TokenType\n    prefix: string\n    pattern: string\n    name: string\n}\n"],"sourceRoot":""}